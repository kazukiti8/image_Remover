# 画像クリーナー (Image Cleaner)

## 概要

このアプリケーションは、指定されたフォルダ内にある「ブレている画像」と「類似している画像ペア」を検出し、ユーザーが確認した上で不要な画像をゴミ箱に移動するためのツールです。

## 機能

* **ブレ画像検出:** FFT（高速フーリエ変換）を用いて画像のシャープネスを評価し、設定された閾値以下の画像を検出します。
* **類似ペア検出:** ORB特徴量を用いて画像間の類似度を計算し、設定された閾値以上の類似度を持つ画像のペアを検出します。
* **プレビュー:** 検出された画像を左右に並べて表示し、比較・確認できます。
* **削除:** 選択した画像（ブレ画像または類似ペアの主画像）をWindowsのゴミ箱に安全に移動します。
* **キーボード/マウス操作:** プレビュー画像に対して、キーボードショートカット（Q/Wで削除、A/Sで開く）やマウスクリック（削除）での操作が可能です。
* **設定:** 検出感度（閾値）やORBパラメータを調整できます。設定は自動的に保存・読み込みされます。

## 動作環境

* Windows OS
* Python 3.8以上推奨 (f-stringの代入式 := を使用している箇所があるため)

## セットアップ

1.  **リポジトリのクローンまたはダウンロード:**
    ```bash
    git clone <リポジトリURL>
    cd image_Remover
    ```
    または、ZIPファイルをダウンロードして展開します。

2.  **仮想環境の作成と有効化 (推奨):**
    ```bash
    python -m venv venv
    .\venv\Scripts\activate
    ```

3.  **必要なライブラリのインストール:**
    ```bash
    pip install -r requirements.txt
    ```
    (`requirements.txt` に記載されているライブラリがインストールされます。)

## 使い方

1.  **起動:** プロジェクトのルートディレクトリで、仮想環境を有効化した後、以下のコマンドを実行します。
    ```bash
    python main.py
    ```
2.  **フォルダ選択:** 「フォルダを選択...」ボタンをクリックし、スキャンしたい画像が含まれるフォルダを選択します。
3.  **設定 (任意):** 「設定...」ボタンをクリックし、ブレ検出や類似ペア検出の閾値などを調整します。デフォルト値でも動作します。
4.  **スキャン開始:** 「スキャン開始」ボタンをクリックします。処理中はプログレスバーとステータスが表示されます。
5.  **結果確認:**
    * スキャンが完了すると、「ブレ画像」タブと「類似ペア」タブに結果が表示されます。
    * テーブルのヘッダーをクリックすると、各列でソートできます。
    * テーブルの行を選択すると、上部のプレビューエリアに画像が表示されます（類似ペアの場合は左右に表示）。
6.  **削除:**
    * **ブレ画像:** 削除したい画像の行頭にあるチェックボックスをオンにします。
    * **類似ペア:** 削除したい主画像が表示されている行を選択します（複数選択可）。
    * 「選択した項目をゴミ箱へ移動」ボタンをクリックします。確認ダイアログが表示されるので、「Yes」を選択するとゴミ箱に移動されます。
    * **プレビューからの削除:** プレビュー画像が表示されている状態で、`Q`キーまたは左画像クリックで左画像を、`W`キーまたは右画像クリックで右画像を（確認ダイアログの後）ゴミ箱に移動できます。
7.  **ファイルを開く:**
    * プレビュー画像が表示されている状態で、`A`キーで左画像を、`S`キーで右画像を、関連付けられたアプリケーションで開くことができます。
8.  **全選択/解除:** 下部のアクションボタンで、各タブの項目を一括で選択・解除できます。

## 設定項目

「設定...」ボタンから以下の項目を調整できます。

* **ブレ検出閾値:** FFTスコアの閾値（0.0〜1.0）。この値**以下**のスコアを持つ画像が「ブレ」と判定されます。値を下げると判定が厳しくなり、上げると緩くなります。
* **ORB 特徴点数:** 類似度計算時に検出する特徴点の最大数。増やすと精度が上がる可能性がありますが、処理が重くなります。
* **ORB Ratio Test 閾値:** 類似ペア判定の際の対応点選別基準（0.1〜0.95）。値を下げると判定が厳しくなります。
* **類似ペア判定 最小マッチ数:** 類似ペアとみなすために必要な最低限の一致特徴点数。値を上げると判定が厳しくなります。

設定はアプリケーション終了時に自動的にホームディレクトリの `.image_cleaner_settings.json` に保存され、次回起動時に読み込まれます。

## 使用ライブラリとライセンス

このアプリケーションは以下の主要なライブラリを使用しています。配布や改変を行う場合は、各ライブラリのライセンス条項に従ってください。

* **PySide6:** LGPL v3 (アプリケーションがこれを使用していること、ライセンス条文、ユーザーによるライブラリ差し替え可能性の担保などが必要です)
* **OpenCV (opencv-python):** Apache 2 / BSD 系ライセンス (MITライセンスはパッケージに対して)
* **NumPy:** BSD 3-Clause License
* **Send2Trash:** BSD 3-Clause License
* **Pillow:** HPND License
* **PyInstaller:** GPL v2 + Linking Exception (ブートローダー) / BSD/MIT系 (その他)

*注意: これはライセンスに関する簡易的な情報です。正確な情報は各ライブラリの公式ドキュメントやライセンスファイルをご確認ください。商用利用や広範囲への再配布を行う場合は、専門家への相談を推奨します。*

## 実行可能ファイル (.exe) の作成 (任意)

開発環境で PyInstaller がインストールされていれば、以下のコマンドで `.exe` ファイルを作成できます。

1.  仮想環境を有効化します。
2.  プロジェクトルートディレクトリでコマンドを実行します。
    * **フォルダ形式:**
        ```bash
        pyinstaller main.py --noconsole --name ImageCleaner
        ```
        (`dist/ImageCleaner` フォルダが生成されます)
    * **単一ファイル形式 (起動が遅くなる可能性あり):**
        ```bash
        pyinstaller main.py --noconsole --name ImageCleaner --onefile
        ```
        (`dist` フォルダ内に `ImageCleaner.exe` が生成されます)

*注意: PySide6 や OpenCV を含むアプリケーションの `.exe` 化は、依存関係の問題で失敗することがあります。その場合は、PyInstaller の `--hidden-import` オプションや `.spec` ファイルの編集が必要になる場合があります。*

